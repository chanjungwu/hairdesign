<!DOCTYPE html>
<html>
<head>
    <title>è·³ç¹©å°å­¸å ‚</title>
    <style>
        :root {
            --primary-blue: #e3f2fd;
            --border-blue: #90caf9;
        }

        body {
            font-family: 'Arial Rounded MT Bold', Arial, sans-serif;
            background-color: white;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            position: relative;
        }

        /* è£é£¾å…ƒç´  */
        .decoration {
            position: fixed;
            z-index: -1;
        }

        .decoration.top-left {
            top: 20px;
            left: 20px;
            font-size: 40px;
        }

        .decoration.top-right {
            top: 20px;
            right: 20px;
            font-size: 40px;
        }

        .decoration.bottom-left {
            bottom: 20px;
            left: 20px;
            font-size: 40px;
        }

        .decoration.bottom-right {
            bottom: 20px;
            right: 20px;
            font-size: 40px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            text-align: center;
            padding: 30px;
            border: 15px solid transparent;
            border-image: linear-gradient(45deg, #ffcdd2, #bbdefb, #c8e6c9, #fff9c4) 1;
            border-radius: 20px;
            background-color: white;
            box-shadow: 
                0 4px 8px rgba(0,0,0,0.1),
                inset 0 0 20px rgba(0,0,0,0.05);
            position: relative;
        }

        .container::before {
            content: 'ğŸ€';
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 40px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .container::after {
            content: '';
            position: absolute;
            top: -5px;
            left: -5px;
            right: -5px;
            bottom: -5px;
            border: 2px solid #e3f2fd;
            border-radius: 25px;
            pointer-events: none;
            z-index: -1;
        }

        /* ç™»å…¥è¡¨å–®æ¨£å¼ */
        .login-form {
            background-color: white;
            padding: 30px;
            border-radius: 15px;
            border: 2px solid var(--border-blue);
            max-width: 400px;
            margin: 50px auto;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #1976d2;
        }

        .form-group input {
            width: 100%;
            padding: 10px;
            border: 2px solid var(--border-blue);
            border-radius: 8px;
            font-size: 16px;
        }

        .submit-btn {
            background-color: #1976d2;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .submit-btn:hover {
            background-color: #1565c0;
            transform: translateY(-2px);
        }

        /* é€²åº¦æ¢æ¨£å¼ */
        .progress-container {
            width: 100%;
            height: 20px;
            background-color: var(--primary-blue);
            border-radius: 10px;
            margin-top: 20px;
            position: relative;
        }

        .progress-bar {
            height: 100%;
            width: 0%;
            background-color: #1976d2;
            border-radius: 10px;
            transition: width 0.3s ease;
        }

        .quiz-marker {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: #ff4081;
            border-radius: 50%;
            top: -5px;
            transform: translateX(-50%);
            cursor: pointer;
        }

        /* ä¸»è¦å…§å®¹å€åŸŸåˆå§‹éš±è— */
        .main-content {
            display: none;
            visibility: hidden;
        }

        /* æç¤ºè¨Šæ¯æ¨£å¼ */
        .message-popup {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: rgba(25, 118, 210, 0.9);
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            display: none;
            animation: slideIn 0.3s ease;
        }

        /* æ•™å¸«æŸ¥è©¢å€åŸŸæ¨£å¼ */
        .teacher-query {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: white;
            padding: 15px;
            border-radius: 10px;
            border: 2px solid var(--border-blue);
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            z-index: 1000;
        }

        .teacher-query input {
            padding: 8px;
            border: 1px solid var(--border-blue);
            border-radius: 5px;
            margin-right: 5px;
        }

        .teacher-query button {
            padding: 8px 15px;
            background-color: #1976d2;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        .query-result-success {
            margin-top: 10px;
            padding: 10px;
            background-color: #e8f5e9;
            border-radius: 5px;
        }

        .query-result-error {
            margin-top: 10px;
            padding: 10px;
            background-color: #ffebee;
            border-radius: 5px;
            color: #c62828;
        }

        .completion-code {
            margin: 20px 0;
            padding: 15px;
            background-color: #e3f2fd;
            border-radius: 10px;
        }

        .code-display {
            font-size: 24px;
            font-weight: bold;
            color: #1976d2;
            padding: 10px;
            margin: 10px 0;
            background-color: white;
            border-radius: 5px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        /* æ’­æ”¾æ§åˆ¶æŒ‰éˆ•æ¨£å¼ */
        .custom-controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 15px;
            padding: 10px;
        }

        .custom-controls button {
            padding: 10px 20px;
            border: none;
            border-radius: 50px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #fff;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .custom-controls button:nth-child(1)::before {
            content: 'â–¶ï¸';
        }

        .custom-controls button:nth-child(2)::before {
            content: 'â¸ï¸';
        }

        .custom-controls button:nth-child(3)::before {
            content: 'ğŸ”‡';
        }

        .custom-controls button:nth-child(4)::before {
            content: 'ğŸ”Š';
        }

        .custom-controls button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
            background: linear-gradient(45deg, #ffebee, #e3f2fd);
        }

        .custom-controls button:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        /* å…¨éƒ¨å­¸ç”Ÿè³‡æ–™è¡¨æ ¼æ¨£å¼ */
        .all-students-table {
            width: 100%;
            margin-top: 20px;
            border-collapse: collapse;
            background-color: white;
            border-radius: 8px;
            overflow: hidden;
        }

        .all-students-table th,
        .all-students-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid var(--border-blue);
        }

        .all-students-table th {
            background-color: var(--primary-blue);
            color: #1976d2;
        }

        .all-students-table tr:hover {
            background-color: #f5f5f5;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); }
            to { transform: translateX(0); }
        }
/* æ¸¬é©—ç›¸é—œæ¨£å¼ */
.quiz-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(255, 255, 255, 0.95);
    display: flex;
    justify-content: center;
    align-items: center;
    opacity: 0;
    transition: opacity 0.5s;
    z-index: 1000;
}

.quiz-container {
    background-color: white;
    padding: 30px;
    border-radius: 20px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    max-width: 500px;
    width: 90%;
    text-align: center;
    border: 3px solid var(--border-blue);
}

.quiz-emoji {
    font-size: 40px;
    margin-bottom: 20px;
}

.quiz-question {
    font-size: 18px;
    margin: 20px 0;
    color: #1976d2;
}

.quiz-option {
    display: block;
    width: 100%;
    padding: 15px;
    margin: 10px 0;
    border: 2px solid var(--border-blue);
    border-radius: 10px;
    background-color: white;
    color: #1976d2;
    cursor: pointer;
    transition: all 0.3s;
}

.quiz-option:hover {
    background-color: var(--primary-blue);
    transform: translateY(-2px);
}

.quiz-feedback {
    margin-top: 20px;
    padding: 15px;
    border-radius: 10px;
}

.feedback-correct {
    background-color: #e8f5e9;
    color: #2e7d32;
    padding: 10px;
    border-radius: 8px;
}

.feedback-incorrect {
    background-color: #ffebee;
    color: #c62828;
    padding: 10px;
    border-radius: 8px;
}

.final-score-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(255, 255, 255, 0.95);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 2000;
}

.final-score-container {
    background-color: white;
    padding: 40px;
    border-radius: 20px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    text-align: center;
    border: 3px solid var(--border-blue);
}

.celebration-emoji {
    font-size: 60px;
    margin-bottom: 20px;
}

.score-display {
    font-size: 24px;
    color: #1976d2;
    margin: 20px 0;
}

.score-message {
    color: #333;
    margin: 20px 0;
}
    </style>
</head>
<body>
    <!-- è£é£¾å…ƒç´  -->
    <div class="decoration top-left">ğŸ¾</div>
    <div class="decoration top-right">ğŸƒ</div>
    <div class="decoration bottom-left">â­</div>
    <div class="decoration bottom-right">ğŸŒŸ</div>

    <!-- æ•™å¸«æŸ¥è©¢å€åŸŸ -->
    <div class="teacher-query">
        <input type="text" id="codeQuery" placeholder="è«‹è¼¸å…¥é€šé—œå¯†èª">
        <button onclick="queryCompletionCode()">æŸ¥è©¢</button>
        <div id="queryResult"></div>
    </div>

    <!-- ç™»å…¥è¡¨å–® -->
    <div class="login-form" id="loginForm">
        <h2>æ­¡è¿ä¾†åˆ°è·³ç¹©å°å­¸å ‚</h2>
        <div class="form-group">
            <label for="studentId">å­¸è™Ÿ (ä¾‹å¦‚: 112029)</label>
            <input type="text" id="studentId" placeholder="è«‹è¼¸å…¥å­¸è™Ÿ">
        </div>
        <div class="form-group">
            <label for="studentName">å§“å</label>
            <input type="text" id="studentName" placeholder="è«‹è¼¸å…¥å§“å">
        </div>
        <button class="submit-btn" onclick="validateStudent()">é€²å…¥èª²ç¨‹</button>
    </div>

    <!-- ä¸»è¦å…§å®¹å€åŸŸï¼ˆåˆå§‹éš±è—ï¼‰ -->
    <div class="main-content" id="mainContent">
        <div class="container">
            <h1>ğŸ¾ è·³ç¹©å°å­¸å ‚ ğŸ¾</h1>
            <div class="welcome-message" id="welcomeMessage"></div>
            <div id="player"></div>
            <div class="progress-container">
                <div class="progress-bar" id="progressBar"></div>
            </div>
        </div>
    </div>

    <!-- æç¤ºè¨Šæ¯ -->
    <div class="message-popup" id="messagePopup"></div>
</body>
</html>
<script>
// å­¸ç”Ÿè³‡æ–™
const studentData = {
    '112029': 'é™³ç’Ÿå­¸',
    '112030': 'é»ƒçœ¾å‹¤',
    '112031': 'æä»¥æ©',
    '112032': 'æ—è”šä¸',
    '112033': 'å»–æ™§åµ',
    '112034': 'å¾ç¿å¾—',
    '112170': 'æ›¾å®‡æ™¨',
    '112036': 'è³´æ™¨ç¢©',
    '112038': 'é¾ç¨‹å¸†',
    '112039': 'æ›¾æŒ¯ç¨‹',
    '112040': 'è©¹æ£‹æ·¯',
    '112041': 'æ²ˆå‡±äº¦',
    '112042': 'é»ƒåƒé€ ',
    '112043': 'å»–æ¢“çš“',
    '112044': 'ç‹å®‰å©•',
    '112045': 'é™³å­èŠ¯',
    '112046': 'é¡è¡èª¼',
    '112047': 'é»ƒå®¥é¦œ',
    '112048': 'ä¸ç¾½å²‘',
    '112049': 'æ—èŠ®è¨€',
    '112050': 'å‘‚é›¨èŠ¯',
    '112051': 'é™³èŠ·ç©',
    '112052': 'é¾å²‘çš£',
    '112053': 'å¼µé¦¨äºˆ',
    '112054': 'è¶™èŠŠç©',
    '112055': 'å³å¯ç­ ',
    '112177': 'æœ±è²ç†™',
    '112178': 'è”¡æ˜€æ†“'
};

let player;
let lastTimeUpdate = 0;
const timeUpdateInterval = 250; // æ›´æ–°é »ç‡ï¼ˆæ¯«ç§’ï¼‰
let youtubeApiReady = false;

// YouTube API è¼‰å…¥
function loadYouTubeAPI() {
    var tag = document.createElement('script');
    tag.src = "https://www.youtube.com/iframe_api";
    var firstScriptTag = document.getElementsByTagName('script')[0];
    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
}

// é©—è­‰å­¸ç”Ÿè³‡æ–™
function validateStudent() {
    const studentId = document.getElementById('studentId').value;
    const studentName = document.getElementById('studentName').value;

    if (!studentId || !studentName) {
        showMessage('è«‹å¡«å¯«å®Œæ•´çš„å­¸è™Ÿå’Œå§“å');
        return;
    }

    if (!studentData[studentId]) {
        showMessage('æŸ¥ç„¡æ­¤å­¸è™Ÿ');
        return;
    }

    if (studentData[studentId] !== studentName) {
        showMessage('å­¸è™Ÿèˆ‡å§“åä¸ç¬¦');
        return;
    }

    // ç™»å…¥æˆåŠŸ
    document.getElementById('loginForm').style.display = 'none';
    const mainContent = document.getElementById('mainContent');
    mainContent.style.display = 'block';
    mainContent.style.visibility = 'visible';
    document.getElementById('welcomeMessage').textContent = `æ­¡è¿ ${studentName} åŒå­¸`;

    // åˆå§‹åŒ– YouTube æ’­æ”¾å™¨
    if (!player) {
        loadYouTubeAPI();
    }
}

// é¡¯ç¤ºæç¤ºè¨Šæ¯
function showMessage(text, duration = 3000) {
    const popup = document.getElementById('messagePopup');
    popup.textContent = text;
    popup.style.display = 'block';
    
    setTimeout(() => {
        popup.style.display = 'none';
    }, duration);
}

// YouTube æ’­æ”¾å™¨åˆå§‹åŒ–
function onYouTubeIframeAPIReady() {
    youtubeApiReady = true;
    player = new YT.Player('player', {
        height: '360',
        width: '640',
        videoId: 'sfBmkBlzG-Y',
        playerVars: {
            disablekb: 1,        // ç¦ç”¨éµç›¤æ§åˆ¶
            controls: 0,         // éš±è—æ’­æ”¾å™¨æ§åˆ¶é …
            modestbranding: 1,   // éš±è— YouTube Logo
            rel: 0,             // ä¸é¡¯ç¤ºç›¸é—œè¦–é »
            showinfo: 0,        // ä¸é¡¯ç¤ºè¦–é »ä¿¡æ¯
            fs: 0              // ç¦ç”¨å…¨è¢å¹•
        },
        events: {
            'onStateChange': onPlayerStateChange,
            'onReady': onPlayerReady
        }
    });
}

// æ’­æ”¾å™¨å°±ç·’
function onPlayerReady(event) {
    // æ·»åŠ è‡ªå®šç¾©æ§åˆ¶æŒ‰éˆ•
    addCustomControls();
    
    // è¨­ç½®é€²åº¦æ¢æ¨™è¨˜
    setupProgressMarkers();
}

// æ’­æ”¾ç‹€æ…‹æ”¹è®Š
function onPlayerStateChange(event) {
    if (event.data == YT.PlayerState.PLAYING) {
        startTimeTracking();
    } else {
        stopTimeTracking();
    }
}

// é–‹å§‹è¿½è¹¤æ™‚é–“
function startTimeTracking() {
    if (!player) return;
    
    const trackTime = () => {
        const currentTime = player.getCurrentTime();
        
        // æª¢æŸ¥æ˜¯å¦è©¦åœ–è·³è½‰
        if (Math.abs(currentTime - lastTimeUpdate) > 2) {
            showMessage('ä¸è¦è·³è½‰å–”ï¼Œæœ‰å°è€ƒé¡Œç›®å–”');
            player.seekTo(lastTimeUpdate, true);
        }
        
        lastTimeUpdate = currentTime;
        updateProgressBar(currentTime);
        
        // æª¢æŸ¥æ¸¬é©—æ™‚é–“é»
        checkQuizTime(currentTime);
        
        if (player.getPlayerState() == YT.PlayerState.PLAYING) {
            setTimeout(trackTime, timeUpdateInterval);
        }
    };
    
    trackTime();
}

// åœæ­¢è¿½è¹¤æ™‚é–“
function stopTimeTracking() {
    clearTimeout(timeUpdateInterval);
}

// æ›´æ–°é€²åº¦æ¢
function updateProgressBar(currentTime) {
    const duration = player.getDuration();
    const progress = (currentTime / duration) * 100;
    document.getElementById('progressBar').style.width = `${progress}%`;
}

// æ·»åŠ è‡ªå®šç¾©æ§åˆ¶æŒ‰éˆ•
function addCustomControls() {
    const controlsDiv = document.createElement('div');
    controlsDiv.className = 'custom-controls';
    controlsDiv.innerHTML = `
        <button onclick="playVideo()">æ’­æ”¾</button>
        <button onclick="pauseVideo()">æš«åœ</button>
        <button onclick="muteVideo()">éœéŸ³</button>
        <button onclick="unmuteVideo()">å–æ¶ˆéœéŸ³</button>
    `;
    
    document.getElementById('player').after(controlsDiv);
}

// æ’­æ”¾å™¨æ§åˆ¶å‡½æ•¸
function playVideo() { if (player) player.playVideo(); }
function pauseVideo() { if (player) player.pauseVideo(); }
function muteVideo() { if (player) player.mute(); }
function unmuteVideo() { if (player) player.unMute(); }
</script>
<script>
// æ¸¬é©—é¡Œç›®è³‡æ–™
const quizzes = [
    {
        time: 60,
        question: "è·³ç¹©çš„é•·åº¦ï¼Œè¸©è‘—è·³ç¹©æ¸¬é‡åˆ°å“ªè£¡é©åˆï¼Ÿ",
        options: ["è…‹ä¸‹", "è…°éƒ¨", "é ­é ‚", "è†è“‹"],
        correct: 0,
        feedback: {
            correct: "ç­”å°äº†ï¼è·³ç¹©é•·åº¦åˆ°è…‹ä¸‹æ˜¯æœ€é©åˆçš„ï¼",
            incorrect: "ç­”éŒ¯äº†ï¼æ­£ç¢ºç­”æ¡ˆæ˜¯è…‹ä¸‹å–”ï¼è·³ç¹©å¤ªé•·æˆ–å¤ªçŸ­éƒ½æœƒå½±éŸ¿è·³ç¹©çš„é †æš¢åº¦ã€‚"
        }
    },
    {
        time: 94,
        question: "æ§åˆ¶è·³ç¹©æ–¹å‘ä¸»è¦ä½¿ç”¨ï¼š",
        options: ["å°æ‹‡æŒ‡", "ç„¡åæŒ‡", "æ‰‹è‚˜", "å¤§æ‹‡æŒ‡"],
        correct: 3,
        feedback: {
            correct: "æ²’éŒ¯ï¼ä½¿ç”¨å¤§æ‹‡æŒ‡ä¾†æ§åˆ¶è·³ç¹©æ–¹å‘æœ€æº–ç¢ºï¼",
            incorrect: "ä¸å°å–”ï¼ä½¿ç”¨å¤§æ‹‡æŒ‡ä¾†æ§åˆ¶è·³ç¹©æ–¹å‘æ‰æ˜¯æ­£ç¢ºçš„åšæ³•ï¼"
        }
    },
    {
        time: 124,
        question: "æ•™ç·´èªç‚ºè·³ç¹©æœ€å¤§çš„ç½©é–€(å›°é›£è™•)æ˜¯å“ªå€‹ï¼Ÿ",
        options: ["è·³èºé«˜åº¦", "èº«é«˜", "ç”©ç¹©", "é ­éƒ¨å¤§å°"],
        correct: 2,
        feedback: {
            correct: "ç­”å°äº†ï¼ç”©ç¹©ç¢ºå¯¦æ˜¯æœ€å›°é›£çš„éƒ¨åˆ†ï¼",
            incorrect: "ç­”éŒ¯äº†ï¼ç”©ç¹©æŠ€å·§æ˜¯æœ€å¤§çš„å›°é›£è™•å–”ï¼"
        }
    },
    {
        time: 145,
        question: "å½±ç‰‡æ•™ç·´èªªæ˜è·³ç¹©æ™‚è†è“‹ä¸è¦éåº¦æ‰“ç›´ï¼Œæ‰¿èè€å¸«å‰‡èªç‚ºï¼Œå°æœ‹å‹åˆå­¸è·³ç¹©æ™‚ï¼Œè†è“‹æ‡‰...",
        options: ["ç›¡å¯èƒ½å½æ›²", "æ‰“ç›´ä¸€é»"],
        correct: 1,
        feedback: {
            correct: "æ‰¿èè€å¸«èªç‚ºå°æœ‹å‹è·³ç¹©æ™‚è†è“‹éå½çš„æƒ…å½¢å¤šæ–¼è†è“‹éæ–¼æ‰“ç›´çš„æƒ…å½¢ï¼Œå› æ­¤é¼“å‹µåŒå­¸è†è“‹æ‰“ç›´ä¸€äº›ã€‚",
            incorrect: "ç­”éŒ¯äº†ï¼æ‰¿èè€å¸«å»ºè­°åˆå­¸è€…æ‡‰è©²è¦æŠŠè†è“‹æ‰“ç›´ä¸€é»å–”ï¼"
        }
    },
    {
        time: 225,
        question: "æ•™ç·´èªªè·³èºçš„é«˜åº¦ç´„å¹¾å…¬åˆ†ï¼š",
        options: ["2.5~5å…¬åˆ†", "10~15å…¬åˆ†", "15~20å…¬åˆ†", "20~25å…¬åˆ†"],
        correct: 0,
        feedback: {
            correct: "æ­£ç¢ºï¼è·³èºä¸éœ€è¦å¤ªé«˜ï¼Œ2.5~5å…¬åˆ†å°±è¶³å¤ äº†ï¼",
            incorrect: "ç­”éŒ¯äº†ï¼è·³ç¹©æ™‚åªéœ€è¦è·³2.5~5å…¬åˆ†çš„é«˜åº¦å°±å¤ äº†ï¼Œä¸éœ€è¦è·³å¤ªé«˜å–”ï¼"
        }
    },
    {
        time: 450,
        question: "æœ¬èª²å ‚æ´»å‹•éå•†æ¥­æ´»å‹•ï¼Œå› æ­¤ä¸é¼“å‹µ(ä¹Ÿä¸åå°)å°æœ‹å‹ä¸Šå‚³å½±ç‰‡è‡³æ³°èŒæ•™ç·´èªªçš„ç¶²ç«™ï¼Œäº†è§£å—ï¼Ÿ",
        options: ["äº†è§£", "æ‡‚äº†", "éå¸¸äº†è§£", "éµå‘½"],
        correct: [0, 1, 2, 3],
        feedback: {
            correct: "è¬è¬ä½ çš„ç†è§£ï¼",
            incorrect: "è«‹å†ä»”ç´°æƒ³æƒ³ï½"
        }
    }
];

let score = 0;
const totalQuestions = quizzes.length;

// è¨­ç½®é€²åº¦æ¢æ¸¬é©—æ¨™è¨˜
function setupProgressMarkers() {
    const duration = player.getDuration();
    const progressContainer = document.querySelector('.progress-container');
    
    quizzes.forEach((quiz, index) => {
        const marker = document.createElement('div');
        marker.className = 'quiz-marker';
        marker.style.left = `${(quiz.time / duration) * 100}%`;
        marker.title = `æ¸¬é©— ${index + 1}`;
        progressContainer.appendChild(marker);
    });
}

// æª¢æŸ¥æ¸¬é©—æ™‚é–“é»
function checkQuizTime(currentTime) {
    quizzes.forEach((quiz, index) => {
        if (Math.abs(currentTime - quiz.time) < 1 && !quiz.completed) {
            showQuiz(index);
            quiz.completed = true;
            player.pauseVideo();
        }
    });
}

// é¡¯ç¤ºæ¸¬é©—
function showQuiz(index) {
    const quiz = quizzes[index];
    const overlay = document.createElement('div');
    overlay.className = 'quiz-overlay';
    overlay.innerHTML = `
        <div class="quiz-container">
            <div class="quiz-emoji">ğŸ“</div>
            <h3>ç¬¬ ${index + 1} é¡Œ</h3>
            <div class="quiz-question">${quiz.question}</div>
            <div class="quiz-options">
                ${quiz.options.map((option, i) => `
                    <button class="quiz-option" onclick="checkAnswer(${index}, ${i})">${option}</button>
                `).join('')}
            </div>
            <div class="quiz-feedback"></div>
        </div>
    `;
    document.body.appendChild(overlay);

    // æ·»åŠ å‹•ç•«æ•ˆæœ
    setTimeout(() => overlay.style.opacity = '1', 0);
}

// æª¢æŸ¥ç­”æ¡ˆ
function checkAnswer(quizIndex, selectedOption) {
    const quiz = quizzes[quizIndex];
    const overlay = document.querySelector('.quiz-overlay');
    const feedback = overlay.querySelector('.quiz-feedback');
    
    const isCorrect = Array.isArray(quiz.correct) 
        ? quiz.correct.includes(selectedOption)
        : selectedOption === quiz.correct;

    if (isCorrect) {
        score++;
        feedback.innerHTML = `
            <div class="feedback-correct">
                <span class="emoji">âœ¨</span>
                ${quiz.feedback.correct}
            </div>
        `;
        
        // å»¶é²å¾Œç¹¼çºŒæ’­æ”¾
        setTimeout(() => {
            overlay.style.opacity = '0';
            setTimeout(() => {
                overlay.remove();
                player.playVideo();
                
                // æª¢æŸ¥æ˜¯å¦å®Œæˆæ‰€æœ‰æ¸¬é©—
                if (quizzes.every(q => q.completed)) {
                    showFinalScore();
                }
            }, 500);
        }, 2000);
    } else {
        feedback.innerHTML = `
            <div class="feedback-incorrect">
                <span class="emoji">ğŸ’¡</span>
                ${quiz.feedback.incorrect}
            </div>
        `;
    }
}
</script>
<script>
// ç”Ÿæˆé€šé—œå¯†èª
function generateCompletionCode(studentId, score) {
    const lastTwoDigits = studentId.slice(-2);
    const randomNum = Math.floor(Math.random() * 9000 + 1000); // 4ä½éš¨æ©Ÿæ•¸å­—
    const completionCode = `${lastTwoDigits}${score}${randomNum}`;
    
    // å„²å­˜è³‡æ–™åˆ° localStorage
    const studentData = {
        studentId: studentId,
        studentName: document.getElementById('welcomeMessage').textContent.split(' ')[1],
        score: score,
        completionCode: completionCode,
        completionTime: new Date().toLocaleString()
    };
    
    // å„²å­˜æˆ–æ›´æ–°å­¸ç”Ÿç´€éŒ„
    const allRecords = JSON.parse(localStorage.getItem('studentRecords') || '{}');
    allRecords[studentId] = studentData;
    localStorage.setItem('studentRecords', JSON.stringify(allRecords));
    localStorage.setItem(completionCode, JSON.stringify(studentData));
    
    return completionCode;
}

// é¡¯ç¤ºæœ€çµ‚åˆ†æ•¸å’Œé€šé—œå¯†èª
function showFinalScore() {
    const studentId = document.getElementById('studentId').value;
    const completionCode = generateCompletionCode(studentId, score);
    
    const scoreOverlay = document.createElement('div');
    scoreOverlay.className = 'final-score-overlay';
    scoreOverlay.innerHTML = `
        <div class="final-score-container">
            <div class="celebration-emoji">ğŸ‰</div>
            <h2>æ­å–œå®Œæˆæ‰€æœ‰æ¸¬é©—ï¼</h2>
            <div class="score-display">
                å¾—åˆ†ï¼š${score}/${totalQuestions}
            </div>
            <div class="score-message">
                ${getScoreMessage(score)}
            </div>
            <div class="completion-code">
                <h3>æ‚¨çš„é€šé—œå¯†èª</h3>
                <div class="code-display">${completionCode}</div>
                <p>è«‹å°‡æ­¤é€šé—œå¯†èªäº¤çµ¦è€å¸«ä»¥è­‰æ˜å®Œæˆæ¸¬é©—</p>
            </div>
            <button onclick="this.parentElement.parentElement.remove()">å®Œæˆ</button>
        </div>
    `;
    document.body.appendChild(scoreOverlay);
}

// æ ¹æ“šåˆ†æ•¸çµ¦äºˆè©•èª
function getScoreMessage(score) {
    const percentage = (score / totalQuestions) * 100;
    if (percentage === 100) return "å¤ªæ£’äº†ï¼ä½ å®Œå…¨æŒæ¡äº†è·³ç¹©çš„è¦é ˜ï¼ğŸŒŸ";
    if (percentage >= 80) return "åšå¾—å¾ˆå¥½ï¼å†å¤šç·´ç¿’ä¸€ä¸‹å°±æ›´å®Œç¾äº†ï¼âœ¨";
    if (percentage >= 60) return "åŠæ ¼å›‰ï¼ç¹¼çºŒåŠ æ²¹ï¼ğŸ’ª";
    return "è¦å¤šå¤šç·´ç¿’å–”ï¼åˆ¥ç°å¿ƒï¼ğŸ“š";
}

// æŸ¥è©¢é€šé—œå¯†èª
function queryCompletionCode() {
    const code = document.getElementById('codeQuery').value.trim();
    const resultDiv = document.getElementById('queryResult');

    // æª¢æŸ¥æ˜¯å¦æ˜¯æŸ¥çœ‹æ‰€æœ‰å­¸ç”Ÿçš„ç‰¹æ®Šä»£ç¢¼
    if (code === '9292929') {
        showAllStudentRecords();
        return;
    }
    
    const studentData = localStorage.getItem(code);
    if (studentData) {
        const data = JSON.parse(studentData);
        resultDiv.innerHTML = `
            <div class="query-result-success">
                <p>å­¸è™Ÿï¼š${data.studentId}</p>
                <p>å§“åï¼š${data.studentName}</p>
                <p>å¾—åˆ†ï¼š${data.score}/${totalQuestions}</p>
                <p>å®Œæˆæ™‚é–“ï¼š${data.completionTime}</p>
            </div>
        `;
    } else {
        resultDiv.innerHTML = `
            <div class="query-result-error">
                æœªæ‰¾åˆ°æ­¤é€šé—œå¯†èªçš„ç´€éŒ„
            </div>
        `;
    }
}

// é¡¯ç¤ºæ‰€æœ‰å­¸ç”Ÿè¨˜éŒ„
function showAllStudentRecords() {
    const resultDiv = document.getElementById('queryResult');
    const allRecords = JSON.parse(localStorage.getItem('studentRecords') || '{}');
    
    if (Object.keys(allRecords).length === 0) {
        resultDiv.innerHTML = `
            <div class="query-result-error">
                ç›®å‰é‚„æ²’æœ‰å­¸ç”Ÿå®Œæˆæ¸¬é©—
            </div>
        `;
        return;
    }

    let tableHTML = `
        <table class="all-students-table">
            <thead>
                <tr>
                    <th>å­¸è™Ÿ</th>
                    <th>å§“å</th>
                    <th>å¾—åˆ†</th>
                    <th>é€šé—œå¯†èª</th>
                    <th>å®Œæˆæ™‚é–“</th>
                </tr>
            </thead>
            <tbody>
    `;

    for (const studentId in allRecords) {
        const data = allRecords[studentId];
        tableHTML += `
            <tr>
                <td>${data.studentId}</td>
                <td>${data.studentName}</td>
                <td>${data.score}/${totalQuestions}</td>
                <td>${data.completionCode}</td>
                <td>${data.completionTime}</td>
            </tr>
        `;
    }

    tableHTML += `
            </tbody>
        </table>
    `;

    resultDiv.innerHTML = tableHTML;
}

// åœ¨é é¢åŠ è¼‰æ™‚æ¸…ç†éæœŸçš„è³‡æ–™ï¼ˆå¯é¸ï¼‰
function cleanupOldData() {
    const oneWeekAgo = new Date();
    oneWeekAgo.setDate(oneWeekAgo.getDate() - 7);
    
    const allRecords = JSON.parse(localStorage.getItem('studentRecords') || '{}');
    let cleaned = false;
    
    for (const studentId in allRecords) {
        const completionTime = new Date(allRecords[studentId].completionTime);
        if (completionTime < oneWeekAgo) {
            delete allRecords[studentId];
            cleaned = true;
        }
    }
    
    if (cleaned) {
        localStorage.setItem('studentRecords', JSON.stringify(allRecords));
    }
}

// åœ¨é é¢è¼‰å…¥æ™‚åŸ·è¡Œæ¸…ç†
window.addEventListener('load', cleanupOldData);
</script>